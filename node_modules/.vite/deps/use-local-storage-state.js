import {
  require_react
} from "./chunk-YCER7KSF.js";
import {
  __toESM
} from "./chunk-5CYG367S.js";

// node_modules/use-local-storage-state/es/src/useLocalStorageState.js
var import_react = __toESM(require_react());
var inMemoryData = /* @__PURE__ */ new Map();
function useLocalStorageState(key, options) {
  const defaultValue = options === null || options === void 0 ? void 0 : options.defaultValue;
  if (typeof window === "undefined") {
    return [
      defaultValue,
      () => {
      },
      {
        isPersistent: true,
        removeItem: () => {
        }
      }
    ];
  }
  const serializer = options === null || options === void 0 ? void 0 : options.serializer;
  return useClientLocalStorageState(key, defaultValue, options === null || options === void 0 ? void 0 : options.storageSync, serializer === null || serializer === void 0 ? void 0 : serializer.parse, serializer === null || serializer === void 0 ? void 0 : serializer.stringify);
}
function useClientLocalStorageState(key, defaultValue, storageSync = true, parse = parseJSON, stringify = JSON.stringify) {
  const initialDefaultValue = (0, import_react.useRef)(defaultValue).current;
  if (!inMemoryData.has(key) && initialDefaultValue !== void 0 && localStorage.getItem(key) === null) {
    try {
      localStorage.setItem(key, stringify(initialDefaultValue));
    } catch (_a) {
    }
  }
  const storageValue = (0, import_react.useRef)({
    item: null,
    parsed: initialDefaultValue
  });
  const value = (0, import_react.useSyncExternalStore)((0, import_react.useCallback)((onStoreChange) => {
    const onChange = (localKey) => {
      if (key === localKey) {
        onStoreChange();
      }
    };
    callbacks.add(onChange);
    return () => {
      callbacks.delete(onChange);
    };
  }, [key]), () => {
    const item = localStorage.getItem(key);
    if (inMemoryData.has(key)) {
      storageValue.current = {
        item,
        parsed: inMemoryData.get(key)
      };
    } else if (item !== storageValue.current.item) {
      let parsed;
      try {
        parsed = item === null ? initialDefaultValue : parse(item);
      } catch (_a) {
        parsed = initialDefaultValue;
      }
      storageValue.current = {
        item,
        parsed
      };
    }
    return storageValue.current.parsed;
  }, () => initialDefaultValue);
  const setState = (0, import_react.useCallback)((newValue) => {
    const value2 = newValue instanceof Function ? newValue(storageValue.current.parsed) : newValue;
    try {
      localStorage.setItem(key, stringify(value2));
      inMemoryData.delete(key);
    } catch (_a) {
      inMemoryData.set(key, value2);
    }
    triggerCallbacks(key);
  }, [key, stringify]);
  (0, import_react.useEffect)(() => {
    if (!storageSync) {
      return void 0;
    }
    const onStorage = (e) => {
      if (e.storageArea === localStorage && e.key === key) {
        triggerCallbacks(key);
      }
    };
    window.addEventListener("storage", onStorage);
    return () => window.removeEventListener("storage", onStorage);
  }, [key, storageSync]);
  return (0, import_react.useMemo)(() => [
    value,
    setState,
    {
      isPersistent: value === initialDefaultValue || !inMemoryData.has(key),
      removeItem() {
        inMemoryData.delete(key);
        localStorage.removeItem(key);
        triggerCallbacks(key);
      }
    }
  ], [key, setState, value, initialDefaultValue]);
}
var callbacks = /* @__PURE__ */ new Set();
function triggerCallbacks(key) {
  for (const callback of [...callbacks]) {
    callback(key);
  }
}
function parseJSON(value) {
  return value === "undefined" ? void 0 : JSON.parse(value);
}

// node_modules/use-local-storage-state/es/index.js
var es_default = useLocalStorageState;

// dep:use-local-storage-state
var use_local_storage_state_default = es_default;
export {
  use_local_storage_state_default as default
};
//# sourceMappingURL=use-local-storage-state.js.map
